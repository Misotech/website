{"data":"<h1 id=\"jupyter\">Jupyter</h1>\n<p>Шикарный инструмент для анализа данных и машинного обучения, о нем можно рассказывать бесконечно. Установлен в составе сборки аналитического пакета Anaconda, уже есть все необходимое для работы с данными.</p><p class=\"warn\"><strong>Доступ в Jupyter</strong> По адресу <a href=\"http://172.16.25.1:8888\">http://172.16.25.1:8888</a> после <a href=\"connect-vpn\">подключения к VPN</a></p><h2 id=\"-\">Блокноты</h2>\n<ul>\n<li><a href=\"/../ipbooks/move_to_new_tables.html\" title=\":ignore\">Notebook 1. Миграция на 2.0</a></li>\n<li>[Notebook 2. Интеграция с crm]/(/../ipbooks/crm_integration.html &#39;:ignore&#39;)</li>\n</ul>\n<h2 id=\"-\">Подключение к БД</h2>\n<p><img src=\"/static/media/jupyter/main.png\" alt=\"\"></p><p>Подключение к базе данных</p><pre><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> json\nfrom simpleclickhouse.clickhose <span class=\"hljs-keyword\">import</span> ClickHouse\nch = ClickHouse(<span class=\"hljs-string\">'172.16.25.1'</span>, db=<span class=\"hljs-string\">'alco'</span>)</code></pre>\n<p>Чтение данных стримом</p><pre><code class=\"language-python\"><span class=\"hljs-comment\"># период</span>\ndt = date.today()\ndf = dt - timedelta(days=<span class=\"hljs-number\">30</span>)\n\nquery = <span class=\"hljs-string\">'''\nSELECT *\nFROM events\nWHERE date &gt; '{df}' and date &lt;= '{dt}'\nLIMIT 100\nFORMAT JSONEachRow\n'''</span>.format(df=df.strftime(<span class=\"hljs-string\">'%Y-%m-%d'</span>), dt=dt.strftime(<span class=\"hljs-string\">'%Y-%m-%d'</span>))\n\nres = ch.select_stream(query)\n\n<span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> res.iter_lines():\n    <span class=\"hljs-keyword\">if</span> line:\n        decoded_line = line.decode(<span class=\"hljs-string\">'utf-8'</span>)\n        row = json.loads(decoded_line)\n        print(row)\n</code></pre>\n<p>Запись данных</p><pre><code class=\"language-python\"><span class=\"hljs-keyword\">for</span> <span class=\"hljs-selector-tag\">i</span> <span class=\"hljs-keyword\">in</span> range(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1000</span>):\n    self<span class=\"hljs-selector-class\">.storage</span><span class=\"hljs-selector-class\">.push</span>(<span class=\"hljs-string\">'temp_tamble'</span>, {<span class=\"hljs-string\">'num'</span>: i})\n\nself<span class=\"hljs-selector-class\">.storage</span><span class=\"hljs-selector-class\">.flush</span>(<span class=\"hljs-string\">'temp_tamble'</span>)</code></pre>\n<p>Коннектор автоматически сбрасывает данные в ClickHouse через каждые 50000 строк. В конце обработки необходимо вручную отправить остаток.</p>"}