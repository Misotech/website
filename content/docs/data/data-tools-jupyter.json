{"data":"<h1 id=\"jupyter\">Jupyter</h1>\n<p>Шикарный инструмент для анализа данных и машинного обучения, о нем можно рассказывать бесконечно. Установлен в составе сборки аналитического пакета Anaconda, уже есть все необходимое для работы с данными.</p>\n<p>?&gt; <strong>Доступ в Jupyter</strong> По адресу <a href=\"http://172.16.25.1:8888\">http://172.16.25.1:8888</a> после <a href=\"connect-vpn\">подключения к VPN</a></p>\n<h2 id=\"-\">Блокноты</h2>\n<ul>\n<li><a href=\"/../ipbooks/move_to_new_tables.html\" title=\":ignore\">Notebook 1. Миграция на 2.0</a></li>\n<li>[Notebook 2. Интеграция с crm]/(/../ipbooks/crm_integration.html &#39;:ignore&#39;)</li>\n</ul>\n<h2 id=\"-\">Подключение к БД</h2>\n<p><img src=\"/static/media/jupyter/main.png\" alt=\"\"></p>\n<p>Подключение к базе данных</p>\n<pre><code class=\"language-python\">import json\nfrom simpleclickhouse.clickhose import ClickHouse\nch = ClickHouse(&#39;172.16.25.1&#39;, db=&#39;alco&#39;)</code></pre>\n<p>Чтение данных стримом</p>\n<pre><code class=\"language-python\"># период\ndt = date.today()\ndf = dt - timedelta(days=30)\n\nquery = &#39;&#39;&#39;\nSELECT *\nFROM events\nWHERE date &gt; &#39;{df}&#39; and date &lt;= &#39;{dt}&#39;\nLIMIT 100\nFORMAT JSONEachRow\n&#39;&#39;&#39;.format(df=df.strftime(&#39;%Y-%m-%d&#39;), dt=dt.strftime(&#39;%Y-%m-%d&#39;))\n\nres = ch.select_stream(query)\n\nfor line in res.iter_lines():\n    if line:\n        decoded_line = line.decode(&#39;utf-8&#39;)\n        row = json.loads(decoded_line)\n        print(row)\n</code></pre>\n<p>Запись данных</p>\n<pre><code class=\"language-python\">for i in range(1, 1000):\n    self.storage.push(&#39;temp_tamble&#39;, {&#39;num&#39;: i})\n\nself.storage.flush(&#39;temp_tamble&#39;)</code></pre>\n<p>Коннектор автоматически сбрасывает данные в ClickHouse через каждые 50000 строк. В конце обработки необходимо вручную отправить остаток.</p>\n"}