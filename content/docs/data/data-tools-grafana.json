{
  "parent": "exploitation-data",
  "slug": "exploitation-data-grafana",
  "bodyContent": "# Grafana\n\n?> **Доступ в Grafana** по адресу http://172.16.25.1:3000 после [подключения к VPN](connect-vpn). Данные для входа **admin**/**admin**\n\n\n#№ Добавление ClickHouse data source в Grafana\n\nСводится к добавлению нового источника данных\n\n![](/static/media/data_tools_grafana/add_data_source.png)\n\n**Параметры подключения**\n\nName: AlcolyticsDB\nType: ClickHouse\nURL: http://172.16.25.1:8123\nAccess: proxy\nBasic Auth: да\nLogin/Password: alco\nAdd CORS flag to requests: да\n\n![](/static/media/data_tools_grafana/data_source_settings.png)\n\nПосле нажатия \"Save & Test\" вы должны увидеть сообщение об успешной проверке и добавлении нового источника данных\n\n![](/static/media/data_tools_grafana/add_source_success.png)\n\n## Создание Dashboard\n\nПереходим в раздел дашбордов\n\n![](/static/media/data_tools_grafana/dashboards.png)\n\nСледуя предлагаемым действиям переходим к созданию своего первого дашборда\n\n![](/static/media/data_tools_grafana/create_dashboard.png)\n\n## Первый Graph виджет\n\nВ качестве тренировки создадим виджет, который разложит сессии по типу девайса: десктом/мобильный/etc. В интерфейсе конфигурации дашборда выбираем виджет Graph\n\n![](/static/media/data_tools_grafana/create_graph_widget.png)\n\nПопадаем в превью виджета, из которого можем перейти в его настройки\n\n![](/static/media/data_tools_grafana/widget_setup.png)\n\nУстановите базу данных **alco** и таблицу **events** , затем перейдите к созданию запроса\n\n![](/static/media/data_tools_grafana/create_request.png)\n\nПервым делом в разделе \"Metrics\" укажем шаг сглаживания данных 5m (5 минут), этого вполне достаточно. Но при наличии достаточного объема данных, можете поиграться, изменяя в большую или меньшую сторону. Указываем запрос:\n\n```sql\n$columns(device_type, count() amount) FROM $table WHERE name = 'session'\n```\n\nТут мы используем готовый макрос для построения запросов $columns и отбираем только события типа session\n\n![](/static/media/data_tools_grafana/filter_session.png)\n\nПереходим на вкладку General. В Title пишем \"Device types\"\n\n![](/static/media/data_tools_grafana/device_types.png)\n\nПереходим на вкладку Display и устанавливаем Null value = null as zero, затем выходим из режима управления виджетом\n\n![](/static/media/data_tools_grafana/null_value.png)\n\nТеперь можно сохранить дашборд нажатием CMD (CTRL) + S или кликнув на соответствующую иконку\n\n![](/static/media/data_tools_grafana/save_dashboard.png)\n\n## Создание Pie Chart\n\nНаведите курсор в самую левую часть строки, откроется менюха, где выбираем Add Panel, затем Pie Chart.\n\n![](/static/media/data_tools_grafana/add_panel.png)\n\nКак и в предыдущем примере, переходим в интерфейс настроек виджета, первым делом указываем источник данных: база alco, таблица events, переходим к запросу.\n\n```sql\nSELECT\n  1,\n  groupArray((type, Events))\nFROM (\n  SELECT\n    if(session_num = 1, 'New', 'Returning') as type,\n    count() AS Events\n  FROM $table\n  WHERE\n    $timeFilter\n    AND name = 'session'\n  GROUP BY type\n  ORDER BY Events desc\n)\n```\n\nСтавим Step = 1h (один час). Вот, что должно получиться:\n\n![](/static/media/data_tools_grafana/set_step.png)\n\nУстанавливаем имя, выходим из режима редактирования. Вот что получаем в итоге:\n\n![](/static/media/data_tools_grafana/pie_chart_screenshot.png)\n\nНе забываем сохраниться\n\n## Базовый дашборд\n\nИмеется конфигурация простенького дашборда, которую вы можете загрузить себе.\nИмпорт находится в меню поиска дашборда, [файл конфигурации](/media/grafana_base_dash.json ':ignore').\n\n\n![](/static/media/data_tools_grafana/home_button.png)\n\n## Полезные ссылки\n\n- Сайт Grafana с кучей примеров https://grafana.com\n- Дока Grafana http://docs.grafana.org/guides/basic_concepts\n- Дока по использованию ClickHouse в Grafana https://grafana.com/plugins/vertamedia-clickhouse-datasource",
  "bodyHtml": "<h1>Grafana</h1>\n<p>?&gt; <strong>Доступ в Grafana</strong> по адресу http://172.16.25.1:3000 после <a href=\"connect-vpn\">подключения к VPN</a>. Данные для входа <strong>admin</strong>/<strong>admin</strong></p>\n<p>#№ Добавление ClickHouse data source в Grafana</p>\n<p>Сводится к добавлению нового источника данных</p>\n<p><img src=\"/static/media/data_tools_grafana/add_data_source.png\" alt=\"\"></p>\n<p><strong>Параметры подключения</strong></p>\n<p>Name: AlcolyticsDB\nType: ClickHouse\nURL: http://172.16.25.1:8123\nAccess: proxy\nBasic Auth: да\nLogin/Password: alco\nAdd CORS flag to requests: да</p>\n<p><img src=\"/static/media/data_tools_grafana/data_source_settings.png\" alt=\"\"></p>\n<p>После нажатия &quot;Save &amp; Test&quot; вы должны увидеть сообщение об успешной проверке и добавлении нового источника данных</p>\n<p><img src=\"/static/media/data_tools_grafana/add_source_success.png\" alt=\"\"></p>\n<h2>Создание Dashboard</h2>\n<p>Переходим в раздел дашбордов</p>\n<p><img src=\"/static/media/data_tools_grafana/dashboards.png\" alt=\"\"></p>\n<p>Следуя предлагаемым действиям переходим к созданию своего первого дашборда</p>\n<p><img src=\"/static/media/data_tools_grafana/create_dashboard.png\" alt=\"\"></p>\n<h2>Первый Graph виджет</h2>\n<p>В качестве тренировки создадим виджет, который разложит сессии по типу девайса: десктом/мобильный/etc. В интерфейсе конфигурации дашборда выбираем виджет Graph</p>\n<p><img src=\"/static/media/data_tools_grafana/create_graph_widget.png\" alt=\"\"></p>\n<p>Попадаем в превью виджета, из которого можем перейти в его настройки</p>\n<p><img src=\"/static/media/data_tools_grafana/widget_setup.png\" alt=\"\"></p>\n<p>Установите базу данных <strong>alco</strong> и таблицу <strong>events</strong> , затем перейдите к созданию запроса</p>\n<p><img src=\"/static/media/data_tools_grafana/create_request.png\" alt=\"\"></p>\n<p>Первым делом в разделе &quot;Metrics&quot; укажем шаг сглаживания данных 5m (5 минут), этого вполне достаточно. Но при наличии достаточного объема данных, можете поиграться, изменяя в большую или меньшую сторону. Указываем запрос:</p>\n<pre><code class=\"hljs\">$columns(device_type, count() amount) FROM $table WHERE name = 'session'</code></pre><p>Тут мы используем готовый макрос для построения запросов $columns и отбираем только события типа session</p>\n<p><img src=\"/static/media/data_tools_grafana/filter_session.png\" alt=\"\"></p>\n<p>Переходим на вкладку General. В Title пишем &quot;Device types&quot;</p>\n<p><img src=\"/static/media/data_tools_grafana/device_types.png\" alt=\"\"></p>\n<p>Переходим на вкладку Display и устанавливаем Null value = null as zero, затем выходим из режима управления виджетом</p>\n<p><img src=\"/static/media/data_tools_grafana/null_value.png\" alt=\"\"></p>\n<p>Теперь можно сохранить дашборд нажатием CMD (CTRL) + S или кликнув на соответствующую иконку</p>\n<p><img src=\"/static/media/data_tools_grafana/save_dashboard.png\" alt=\"\"></p>\n<h2>Создание Pie Chart</h2>\n<p>Наведите курсор в самую левую часть строки, откроется менюха, где выбираем Add Panel, затем Pie Chart.</p>\n<p><img src=\"/static/media/data_tools_grafana/add_panel.png\" alt=\"\"></p>\n<p>Как и в предыдущем примере, переходим в интерфейс настроек виджета, первым делом указываем источник данных: база alco, таблица events, переходим к запросу.</p>\n<pre><code class=\"hljs\"><span class=\"hljs-keyword\">SELECT</span>\n  <span class=\"hljs-number\">1</span>,\n  groupArray((<span class=\"hljs-keyword\">type</span>, <span class=\"hljs-keyword\">Events</span>))\n<span class=\"hljs-keyword\">FROM</span> (\n  <span class=\"hljs-keyword\">SELECT</span>\n    <span class=\"hljs-keyword\">if</span>(session_num = <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'New'</span>, <span class=\"hljs-string\">'Returning'</span>) <span class=\"hljs-keyword\">as</span> <span class=\"hljs-keyword\">type</span>,\n    <span class=\"hljs-keyword\">count</span>() <span class=\"hljs-keyword\">AS</span> <span class=\"hljs-keyword\">Events</span>\n  <span class=\"hljs-keyword\">FROM</span> $<span class=\"hljs-keyword\">table</span>\n  <span class=\"hljs-keyword\">WHERE</span>\n    $timeFilter\n    <span class=\"hljs-keyword\">AND</span> <span class=\"hljs-keyword\">name</span> = <span class=\"hljs-string\">'session'</span>\n  <span class=\"hljs-keyword\">GROUP</span> <span class=\"hljs-keyword\">BY</span> <span class=\"hljs-keyword\">type</span>\n  <span class=\"hljs-keyword\">ORDER</span> <span class=\"hljs-keyword\">BY</span> <span class=\"hljs-keyword\">Events</span> <span class=\"hljs-keyword\">desc</span>\n)</code></pre><p>Ставим Step = 1h (один час). Вот, что должно получиться:</p>\n<p><img src=\"/static/media/data_tools_grafana/set_step.png\" alt=\"\"></p>\n<p>Устанавливаем имя, выходим из режима редактирования. Вот что получаем в итоге:</p>\n<p><img src=\"/static/media/data_tools_grafana/pie_chart_screenshot.png\" alt=\"\"></p>\n<p>Не забываем сохраниться</p>\n<h2>Базовый дашборд</h2>\n<p>Имеется конфигурация простенького дашборда, которую вы можете загрузить себе.\nИмпорт находится в меню поиска дашборда, <a href=\"/media/grafana_base_dash.json\" title=\":ignore\">файл конфигурации</a>.</p>\n<p><img src=\"/static/media/data_tools_grafana/home_button.png\" alt=\"\"></p>\n<h2>Полезные ссылки</h2>\n<ul>\n<li>Сайт Grafana с кучей примеров https://grafana.com</li>\n<li>Дока Grafana http://docs.grafana.org/guides/basic_concepts</li>\n<li>Дока по использованию ClickHouse в Grafana https://grafana.com/plugins/vertamedia-clickhouse-datasource</li>\n</ul>\n",
  "preview": "Grafana\n\n? Доступ в Grafana по адресу http://172.16.25.1:3000 после подключения к VPN. Данные для входа",
  "title": "Grafana",
  "dir": "content/docs/data",
  "base": "data-tools-grafana.json",
  "ext": ".json",
  "sourceBase": "data-tools-grafana.md",
  "sourceExt": ".md"
}