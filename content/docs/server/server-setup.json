{
  "bodyContent": "# Установка и обновление платформы\n\n\n### Минимальная конфигурация\n\nБольшинству проектов хватит небольшого виртуального сервера\n\n- **CPU**: 2 core (лучше 4)\n- **Память**: 8 gb\n- **Диск**: 50 gb, обязательно SSD, будет увеличиваться по необходимости\n- **ОС**: строго Ubuntu Server 16.04\n\nДанной конфигурации будет достаточно для обслуживания нескольких сайтов суммарным объемом визитов 3-4м.\nЕсли отключить трекер активности, можно обслуживать порядка 10м - 20м визитов в месяц\n\n?> **Домен для Rockstat**\n После того, как сервер готов и запущен,\n вам нужно настроить трекинговый домен, на котором будет работать система сбора данных. Обычно это alco.ваш-домен.ru, но можете использовать любой другой. Как именно это сделать, сильно зависит от регистратора домена. Основной смысл: создать А запись, указывающую на IP адрес сервера.\n\n\n### Подключение к серверу\n\nОткройте терминал и подключитесь к серверу по имени домена, к которому привязали сервер, чтобы убедиться в его работоспособности.\n\n```bash\nssh root@alco.pornhub.com\n```\n\nВместо `root`, у вас может быть другой пользователь\n\n\n?> **Подключение к серверу в Windows.** В комплекте Windows нет ssh клиента,\n    но можно воспользоваться программой [putty](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html)\n\n### Запуск скриптика, который сам все сделает\n\nПосле успешного проникновения на объект следует выполнить:\n\nна всякий случай проверим, что curl установлен (нужен для загрузки файлов из интернета, бывает, что не включается в минимальную поставку ubuntu)\n\n```bash\nsudo apt -y update && sudo apt -y install curl\n```\n\nТеперь запускаем скрипт установки/обновления системы\n\n```bash\nbash <(curl -Ss https://raw.githubusercontent.com/alcolytics/alco-bootstrap/master/bin/from-scratch)\n```\n\nНесколько секунд и все готово! После этого скрипт предложит создать файл инвентаря с\nосноными параметрами будущего счетчика. Рекомендую соглашаться.\n\n<img src=\"/media/casts/prepare3.svg\" class=\"asciicast\" />\n\nПервый скрипт загрузил ansible playbook, который произведет процесс полной установки\n\n```bash\nansible-playbook alcolytics.yml --connection=local\n```\n\n<img src=\"/media/casts/setup1.svg\" class=\"asciicast\" />\n\n### Если что-то пошло не так\n\nПодготовка сервера без использования скипта. Установите минимальные необходимые\nзависимости и произведите преднастройку системы, последовательно выполнив все команды.\n\n```bash\nsudo -i\n\napt -y update\n\napt install -y python-minimal python-pip python-netaddr git locales\n\necho -e 'LANG=en_US.UTF-8 LC_ALL=en_US.UTF-8' | sudo tee /etc/default/locale\nlocale-gen en_US.UTF-8\nexport LANG=en_US.UTF-8\nexport LC_ALL=en_US.UTF-8\n\npip install ansible\n\nexit\n\ngit clone https://github.com/alcolytics/alco-bootstrap\ngit submodules init\n\ncd ~/alco-bootstrap\n```\n\nТеперь надо создать файл inventory/private вот с таким содержимым:\n\n```\n[private]\nalcostat ansible_host=alco.yourdomain.com\n\n[private:vars]\ntracker_domain=alco.yourdomain.com\ncontact_email=youemail@example.com\n```\n\nДля это можно использовать редактор `nano` или какой-либо другой\n\n```\nnano inventory/private\n```\n\n\nПосле этого можно запускать процесс установки\n\n```bash\nansible-playbook alcolytics.yml --connection=local\n```\n\n!> **Нигде нет информации, как достать с установленного сервера vpn ключи** И,\n    правда, нет! Изначально план установки был другой, и все рассылалось по почте.\n    Теперь надо воспользоваться scp, если у вас Mac или Linux. `scp root@stat.textapp.me:/srv/alco/ovpn_keys/alco_user1.ovpn .`\n    Если Windows, надо поискать программку вроде winscp, подключиться и скопировать.\n    Ключи тут: `/srv/alco/ovpn_keys`\n\n\n### Секретики в установщике\n\nПо дефолту предусмотрена функция удаленного обновления, для этого в проекте имеется\nспециальный ключ `public_keys/alco.pub`, при помощи которого сервер обновлений может подключатся к серверу Rockstat\nдля выполнения необходимых операций. Если нет желания иметь что-то общее с сервером обновлений,\nпросто удалите этот файлик.\n\n### Автоматическое централизованное обновление\n\nИмеется централизованная система автоматического обновления всех серверов Rockstat.  Для подключения достаточно найти в чате Dmitry Rodin (меня) и попросить\nдобавить сервер в список доставки обновлений.\n\n\n\n### Кастомизация конфигурации\n\nФайлы, чьи имена начинаются с `priv`, расположенные `inventoty/`, `group_vars` и `host_vars` исключены из git\n\n#### Конфигурация установшика\n\nПолный список параметров можно найти в дефолтах ролей в `roles/*/defaults/*`\nНе изменяйте основной файл `group_vars/all`, создайте отдельный файл, совпадающий с названием группы хостов.\nПример: делаете копию `inventory/all` под названием `inventory/private`, создаете файл конфигурации `group_vars/private`,\nвсе указанные настройки перезапишут аналоги из `all`.",
  "bodyHtml": "<h1>Установка и обновление платформы</h1>\n<h3>Минимальная конфигурация</h3>\n<p>Большинству проектов хватит небольшого виртуального сервера</p>\n<ul>\n<li><strong>CPU</strong>: 2 core (лучше 4)</li>\n<li><strong>Память</strong>: 8 gb</li>\n<li><strong>Диск</strong>: 50 gb, обязательно SSD, будет увеличиваться по необходимости</li>\n<li><strong>ОС</strong>: строго Ubuntu Server 16.04</li>\n</ul>\n<p>Данной конфигурации будет достаточно для обслуживания нескольких сайтов суммарным объемом визитов 3-4м.\nЕсли отключить трекер активности, можно обслуживать порядка 10м - 20м визитов в месяц</p>\n<p>?&gt; <strong>Домен для Rockstat</strong>\nПосле того, как сервер готов и запущен,\nвам нужно настроить трекинговый домен, на котором будет работать система сбора данных. Обычно это alco.ваш-домен.ru, но можете использовать любой другой. Как именно это сделать, сильно зависит от регистратора домена. Основной смысл: создать А запись, указывающую на IP адрес сервера.</p>\n<h3>Подключение к серверу</h3>\n<p>Откройте терминал и подключитесь к серверу по имени домена, к которому привязали сервер, чтобы убедиться в его работоспособности.</p>\n<pre><code class=\"hljs\">ssh root@alco.pornhub.com</code></pre><p>Вместо <code>root</code>, у вас может быть другой пользователь</p>\n<p>?&gt; <strong>Подключение к серверу в Windows.</strong> В комплекте Windows нет ssh клиента,\nно можно воспользоваться программой <a href=\"https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html\">putty</a></p>\n<h3>Запуск скриптика, который сам все сделает</h3>\n<p>После успешного проникновения на объект следует выполнить:</p>\n<p>на всякий случай проверим, что curl установлен (нужен для загрузки файлов из интернета, бывает, что не включается в минимальную поставку ubuntu)</p>\n<pre><code class=\"hljs\">sudo apt -y update &amp;&amp; sudo apt -y install curl</code></pre><p>Теперь запускаем скрипт установки/обновления системы</p>\n<pre><code class=\"hljs\">bash &lt;(curl -Ss https://raw.githubusercontent.com/alcolytics/alco-bootstrap/master/bin/from-scratch)</code></pre><p>Несколько секунд и все готово! После этого скрипт предложит создать файл инвентаря с\nосноными параметрами будущего счетчика. Рекомендую соглашаться.</p>\n<p>&lt;img src=&quot;/media/casts/prepare3.svg&quot; class=&quot;asciicast&quot; /&gt;</p>\n<p>Первый скрипт загрузил ansible playbook, который произведет процесс полной установки</p>\n<pre><code class=\"hljs\">ansible-playbook alcolytics.yml --connection=<span class=\"hljs-built_in\">local</span></code></pre><p>&lt;img src=&quot;/media/casts/setup1.svg&quot; class=&quot;asciicast&quot; /&gt;</p>\n<h3>Если что-то пошло не так</h3>\n<p>Подготовка сервера без использования скипта. Установите минимальные необходимые\nзависимости и произведите преднастройку системы, последовательно выполнив все команды.</p>\n<pre><code class=\"hljs\">sudo -i\n\napt -y update\n\napt install -y python-minimal python-pip python-netaddr git locales\n\n<span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">'LANG=en_US.UTF-8 LC_ALL=en_US.UTF-8'</span> | sudo tee /etc/default/locale\nlocale-gen en_US.UTF-8\n<span class=\"hljs-built_in\">export</span> LANG=en_US.UTF-8\n<span class=\"hljs-built_in\">export</span> LC_ALL=en_US.UTF-8\n\npip install ansible\n\n<span class=\"hljs-built_in\">exit</span>\n\ngit <span class=\"hljs-built_in\">clone</span> https://github.com/alcolytics/alco-bootstrap\ngit submodules init\n\n<span class=\"hljs-built_in\">cd</span> ~/alco-bootstrap</code></pre><p>Теперь надо создать файл inventory/private вот с таким содержимым:</p>\n<pre><code>[private]\nalcostat ansible_host=alco.yourdomain.com\n\n[private:vars]\ntracker_domain=alco.yourdomain.com\ncontact_email=youemail@example.com\n</code></pre>\n<p>Для это можно использовать редактор <code>nano</code> или какой-либо другой</p>\n<pre><code>nano inventory/private\n</code></pre>\n<p>После этого можно запускать процесс установки</p>\n<pre><code class=\"hljs\">ansible-playbook alcolytics.yml --connection=<span class=\"hljs-built_in\">local</span></code></pre><p>!&gt; <strong>Нигде нет информации, как достать с установленного сервера vpn ключи</strong> И,\nправда, нет! Изначально план установки был другой, и все рассылалось по почте.\nТеперь надо воспользоваться scp, если у вас Mac или Linux. <code>scp root@stat.textapp.me:/srv/alco/ovpn_keys/alco_user1.ovpn .</code>\nЕсли Windows, надо поискать программку вроде winscp, подключиться и скопировать.\nКлючи тут: <code>/srv/alco/ovpn_keys</code></p>\n<h3>Секретики в установщике</h3>\n<p>По дефолту предусмотрена функция удаленного обновления, для этого в проекте имеется\nспециальный ключ <code>public_keys/alco.pub</code>, при помощи которого сервер обновлений может подключатся к серверу Rockstat\nдля выполнения необходимых операций. Если нет желания иметь что-то общее с сервером обновлений,\nпросто удалите этот файлик.</p>\n<h3>Автоматическое централизованное обновление</h3>\n<p>Имеется централизованная система автоматического обновления всех серверов Rockstat.  Для подключения достаточно найти в чате Dmitry Rodin (меня) и попросить\nдобавить сервер в список доставки обновлений.</p>\n<h3>Кастомизация конфигурации</h3>\n<p>Файлы, чьи имена начинаются с <code>priv</code>, расположенные <code>inventoty/</code>, <code>group_vars</code> и <code>host_vars</code> исключены из git</p>\n<h4>Конфигурация установшика</h4>\n<p>Полный список параметров можно найти в дефолтах ролей в <code>roles/*/defaults/*</code>\nНе изменяйте основной файл <code>group_vars/all</code>, создайте отдельный файл, совпадающий с названием группы хостов.\nПример: делаете копию <code>inventory/all</code> под названием <code>inventory/private</code>, создаете файл конфигурации <code>group_vars/private</code>,\nвсе указанные настройки перезапишут аналоги из <code>all</code>.</p>\n",
  "preview": "Установка и обновление платформы\n\n Минимальная конфигурация\n\nБольшинству проектов хватит небольшого",
  "title": "Установка и обновление платформы",
  "dir": "content/docs/server",
  "base": "server-setup.json",
  "ext": ".json",
  "sourceBase": "server-setup.md",
  "sourceExt": ".md"
}