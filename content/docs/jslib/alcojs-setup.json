{"data":"<h1 id=\"-\">Установка счетчика на сайт</h1>\n<h2 id=\"-\">Подготовка сниппета</h2>\n<pre><code class=\"language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"text/javascript\"</span>&gt;</span><span class=\"javascript\">\n  !<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">w, d, st, rst, se, he</span>) </span>{\n    <span class=\"hljs-keyword\">if</span>(w.rstat) <span class=\"hljs-keyword\">return</span>; rst = w.rstat = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) </span>{\n      <span class=\"hljs-keyword\">var</span> args = <span class=\"hljs-built_in\">Array</span>.prototype.slice.call(<span class=\"hljs-built_in\">arguments</span>);\n      <span class=\"hljs-keyword\">return</span> rst.doCall ? rst.doCall.call(rst, args) : rst._q.push(args); };\n    rst.push = rst; rst._l = !<span class=\"hljs-number\">0</span>; rst._sv = <span class=\"hljs-number\">3.0</span>; rst._q = [];\n    rst._jsl = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">src</span>) </span>{\n      se = d.createElement(st); se.async = !<span class=\"hljs-number\">0</span>; se.src = src;\n      he = d.getElementsByTagName(st)[<span class=\"hljs-number\">0</span>]; he.parentNode.insertBefore(se, he); };\n    rst.attach = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">host</span>)</span>{ rst._host = host; rst._jsl(<span class=\"hljs-string\">'https://'</span>+rst._host+<span class=\"hljs-string\">'/lib.js'</span>); }\n  }(<span class=\"hljs-built_in\">window</span>, <span class=\"hljs-built_in\">document</span>, <span class=\"hljs-string\">'script'</span>);\n  <span class=\"hljs-comment\">// Configuration</span>\n  rstat(<span class=\"hljs-string\">'configure'</span>, {\n    <span class=\"hljs-attr\">projectId</span>: <span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">// &lt;&lt;&lt; придумайте номер сайта, если их несколько</span>\n  });\n  rstat(<span class=\"hljs-string\">'page'</span>); <span class=\"hljs-comment\">// &lt;&lt;&lt; отправка просмотра страницы, убирается на SPA</span>\n  rstat.attach(<span class=\"hljs-string\">'tracker.rockstat.test'</span>) <span class=\"hljs-comment\">// &lt;&lt;&lt; Подставьте домен, на котором расположен трекер</span>\n  <span class=\"hljs-comment\">//rstat('onReady', function(){</span>\n  <span class=\"hljs-comment\">//  console.log('rstat` ready callback! uid:', rstat('getUid'));</span>\n  <span class=\"hljs-comment\">//});</span>\n  <span class=\"hljs-comment\">//rstat('onEvent', function(name, data){</span>\n  <span class=\"hljs-comment\">//  console.log('rstat event callback:', name, data);</span>\n  <span class=\"hljs-comment\">//});</span>\n  <span class=\"hljs-comment\">//rstat('onServerMessage', 'sm', function(name, data){</span>\n  <span class=\"hljs-comment\">//  console.log('onServerMessage', name, data);</span>\n  <span class=\"hljs-comment\">//});</span>\n</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></code></pre>\n<p>В коде вместо <code>TRACKER_DOMAIN</code> нужно подставить, домен на котором расположен трекер.<br>Лучше всего установить код между <code>&lt;head&gt;</code> и <code>&lt;/head&gt;</code> или сразу после <code>&lt;body&gt;</code>. Можно поставить через Google Tag Manager, тут есть свои плюсы, минусы и особенности, надо проверять.</p><p><strong>Доступные параметры</strong></p><table>\n<thead>\n<tr>\n<th>Property</th>\n<th>Type</th>\n<th>Default</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>projectId</td>\n<td>Number</td>\n<td>1</td>\n<td>Произвольный ID сайта/проекта/чего-то еще</td>\n</tr>\n<tr>\n<td>sessionTimeout</td>\n<td>Number</td>\n<td>1800</td>\n<td>Тайм-аут сессии: сколько времени с   последнего события должно пройти</td>\n</tr>\n<tr>\n<td>lastCampaignExpires</td>\n<td>Number</td>\n<td>7776000</td>\n<td>Период, на который запоминаются   последние рекламные метки. Указывается в секундах.</td>\n</tr>\n<tr>\n<td>cookieDomain</td>\n<td>String</td>\n<td>auto</td>\n<td>Домен</td>\n</tr>\n<tr>\n<td>trackActivity</td>\n<td>Boolean</td>\n<td>true</td>\n<td>Флаг автоматического отслеживания   активности посетителей на сайте. Отслеживается движение мышью</td>\n</tr>\n<tr>\n<td>trackClicks</td>\n<td>Boolean</td>\n<td>true</td>\n<td>Автоматическое отслеживание   кликов. Обрабатывает все клики и автоматически классифицирует их на   внутренние и внешние</td>\n</tr>\n<tr>\n<td>trackForms</td>\n<td>Boolean</td>\n<td>true</td>\n<td>Автоматическое отслеживание   взаимодействий с формами. Генерирует события фокуса</td>\n</tr>\n<tr>\n<td>allowHTTP</td>\n<td>Boolean</td>\n<td>false</td>\n<td>По дефолту работает только на   https. Этим параметром можете разрешить работу на http</td>\n</tr>\n</tbody></table>\n<h2 id=\"-gtm\">Через GTM</h2>\n<h3 id=\"-rockstat\">Создание тега Rockstat</h3>\n<p>Создайте новый Пользовательский HTML тег, вставьте ваш код счетчика Rockstat.\nВ расширенных настройках поставьте &quot;Приоритет активации тегов&quot; равным 100.</p><p><img src=\"/static/media/alcojs_setup/gtm_tag_creation.png\" alt=\"\"></p><p>В триггерах выберите All Pages / Все страницы\nЖмем сохранить, указываем имя, например Rockstat</p><h3 id=\"-datalayer\">События, отправляемые с сайта через dataLayer</h3>\n<p>Выбираем тип тега &quot;Пользовательский HTML&quot;</p><pre><code class=\"language-javascript\">&lt;script type=<span class=\"hljs-string\">\"text/javascript\"</span>&gt;\n  var name = ({{category}} || <span class=\"hljs-string\">''</span>) + <span class=\"hljs-string\">'::'</span> + ({{action}} || <span class=\"hljs-string\">''</span>);\n  var data = {};\n  <span class=\"hljs-keyword\">if</span>({{label}}) data.label = {{label}};\n  <span class=\"hljs-keyword\">if</span>({{value}}) data.<span class=\"hljs-keyword\">value</span> = {{value}};\n  alco(<span class=\"hljs-string\">'event'</span>, name, data)\n&lt;/script&gt;</code></pre>\n<p>вместо category, action, label, value подставьте переменные, используемые у вас для передачи этих данных в GA.</p><p>Выбираем триггер, используемый для отправки пользовательских событий в Google (Universal) Analytics.</p><p>Жмем сохранить, указываем имя, например Custom Events to Rockstat</p><h3 id=\"-ga-gtm\">События GA, размеченные через GTM</h3>\n<p>Вам необходимо найти все теги, созданные для отслеживания действий и передачи их в Google (Universal) Analytics, и для каждого их них в расширенных настройках включить активацию тега после. При выборе тега можно сразу создать пользовательский HTML тег, вызывающий событие Rockstat.</p><p><img src=\"/static/media/alcojs_setup/activate_gtm_tag.png\" alt=\"\"></p><p><img src=\"/static/media/alcojs_setup/choose_gtmtag.png\" alt=\"\"></p><p>Содержимое тега</p><pre><code class=\"language-javascript\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"text/javascript\"</span>&gt;</span><span class=\"actionscript\">\n  alco(<span class=\"hljs-string\">'event'</span>, <span class=\"hljs-string\">'CATEGORY::ACTION'</span>, {\n    label: <span class=\"hljs-string\">'LABEL'</span>,\n    value: <span class=\"hljs-string\">'VALUE'</span>\n  })\n</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></code></pre>\n<p>Вместо CATEGORY, ACTION, LABEL, VALUE подставьте соответствующие значения. Если Label или Value события отсутствуют, просто удалите соответствующую строку.</p>"}