# Особенности AlcoJS

## Хранение данных в LocalStorage

AlcoJS хранит все данные в браузере, чтобы избежать их передачи на сервер при каждом запросе (как происходит, при использовании кук, для хранения используется хранилище LocalStorage, которое поддерживается 97+% браузеров.

Но есть особенности LocalStorage:

- www.вашсайт и вашсайт - для LocalStorage это разные сайты с разным хранилищем.
- http://вашсайт и https://вашсайт опять-таки разные сайты с разным хранилищем

Для большинства сайтов это не будет проблемой, т.к. используется https (с редиректом с http), аналогичная ситуация с www.

Известные проблемы, связанные с использованием LocalStorage:
- Не работает в режиме инкогнито

В любом случае не нужно пугаться, даже если какие-то данные окажутся на разных доменах, все равно, все они будут собраны на основе uid (alco user id), для храниения которого используются кука.

## Транспорт

В Rockstat используется несколько различных подходов, для передачи данных на сервер.

### sendBeacon

Самый новый метод передачи данных на сервер, доставка происходит даже при закрытии страницы, но связь односторонняя т.е. с сервера ответ не получить. Используется по-умолчанию в случае доступности в браузере.

### XMLHttpRequest

Стандартный механизм передачи данных, используемый повсеместно. Используется для передечи большинства данных на сервер, при недоступном sendBeacon

### XDomainRequest

Модификация XMLHttpRequest c поддержкой CORS (cross-origin requests) в IE 9.

### Image

Обычная картинка с параметрами. Используется как резервкный транспорт, либо при отсутствии sendBeacon и отправке события, которое может вызвать закрытие страницы. Это связано с тем, что браузеры корректно обрабатывают вызов картинки и unload, в то время, как XMLHttpRequest либо обрывается либо вовсе не отправляется. Кол-во информации, которую можно передать данным способом сильно ограничего, поэтому сообщение на сервер значительно урезается и остаются только самые важные параметры.

### WebSocket

Имеется поддержка, но в данный момент не используется.

## Поддержка SPA

!> Preview status

Заложена базовая поддержка, но не все модули подготоволены к обнулению показателей при вызове alco('page'). Если потребуется гарантированная работа, обращайтесь к разработчикам.
