{"data":"<h1 id=\"-\">Обработка сессий</h1>\n<p>Все происходящие события группируются в активные периоды, называемые сессией или визитом.\nСессия начинается при появлении первого события, заканчивается по тайм-ауту.\nЗапуск новой сессии инициируется даже при скролле или движении мыши,\nпоэтому сессии посетителей, которые оставили вкладку открытой,\nа спустя время вернулись и продолжили работу с сайтом,\nбудут начинаться с событий активности. Помимо тайм-аута,\nактивные сессии могут перезапускаться по причине визита того же самого посетителя,\nно с другого источника.</p>\n<p>Наложение источников:</p>\n<ul>\n<li><strong>реклама, органика, соцсети:</strong> старая сессия закрывается, новая открывается</li>\n<li><strong>прямые, реферальные входы:</strong> сессия не перезапускается</li>\n</ul>\n<h2 id=\"-session\">Событие session</h2>\n<p>Сессия, как и все остальное в Rockstat, является самостоятельным событием, генерируемым в момент старта. В дальнейшем все другие события включают в себя сессионную информацию и являются ее распространителем.</p>\n<h2 id=\"-\">Типы сессий</h2>\n<ul>\n<li><strong>Прямой вход</strong></li>\n<li><strong>Органика</strong></li>\n<li><strong>Рекламная кампания</strong></li>\n<li><strong>Социальные сети</strong></li>\n<li><strong>Реферальная ссылка</strong></li>\n<li><strong>Внутренняя сессия</strong></li>\n</ul>\n<h2 id=\"-\">Рекламная кампании</h2>\n<p>Сессия будет рекламной, если в параметрах есть хоть одна из этих меток: <code>utm_*</code>, <code>yclid</code>, <code>gclid</code>, <code>openstat</code>.\nВ некоторых случаях визит может быть классифицирован как рекламный, на основе referrer, например, c <code>doubleclick.net</code></p>\n<pre><code class=\"language-json\">{\n  &quot;name&quot;: &quot;session&quot;,\n  &quot;session_engine&quot;: &quot;google&quot;, // Идентификатор поискового/рекламного/социального движка\n  &quot;session_pageNum&quot;: 1, // Номер просматриваемой страницы\n  &quot;session_eventNum&quot;: 0, // Номер события (пока еще не было)\n  &quot;session_hasMarks&quot;: 1, // Флаг наличия рекламных меток (на уровне бд, удобнее его иметь)\n  &quot;session_marks&quot;: {\n    &quot;has_gclid&quot;: &quot;1&quot;, // Наличие gclid\n    &quot;utm_campaign&quot;: &quot;feb_camp&quot;,\n    &quot;utm_content&quot;: &quot;ad_1&quot;,\n    &quot;utm_medium&quot;: &quot;cpc&quot;,\n    &quot;utm_source&quot;: &quot;google&quot;\n  },\n  &quot;session_num&quot;: 22, // Номер визита\n  &quot;session_refHost&quot;: &quot;https://google.com&quot;, // Хост из referer\n  &quot;session_start&quot;: &quot;1518849857238&quot;, // timestamp начала сессии (это время)\n  &quot;session_type&quot;: &quot;campaign&quot;, // Классифицированый вид трафика\n  //...\n}</code></pre>\n<h2 id=\"-\">Органика</h2>\n<p>Если источник - домены Google, не реклама и не g+, значит это поисковая система, т.е. органика</p>\n<pre><code class=\"language-json\">{\n  &quot;name&quot;: &quot;session&quot;,\n  &quot;session_engine&quot;: &quot;google&quot;,\n  &quot;session_eventNum&quot;: 0,\n  &quot;session_hasMarks&quot;: 0,\n  &quot;session_marks&quot;: {},\n  &quot;session_num&quot;: 2,\n  &quot;session_pageNum&quot;: 1,\n  &quot;session_refHost&quot;: &quot;google.ru&quot;,\n  &quot;session_start&quot;: &quot;1518857893459&quot;,\n  &quot;session_type&quot;: &quot;organic&quot;,\n  //...общие поля\n}</code></pre>\n<h2 id=\"-\">Соцсети</h2>\n<p>Если источник - социальная сеть и нет рекламных меток, значит трафик социальный</p>\n<pre><code class=\"language-json\">{\n  &quot;name&quot;: &quot;session&quot;,\n  &quot;session_engine&quot;: &quot;vk&quot;,\n  &quot;session_eventNum&quot;: 0,\n  &quot;session_hasMarks&quot;: 0,\n  &quot;session_marks&quot;: {},\n  &quot;session_num&quot;: 4,\n  &quot;session_pageNum&quot;: 1,\n  &quot;session_refHost&quot;: &quot;away.vk.com&quot;,\n  &quot;session_start&quot;: &quot;1518856888877&quot;,\n  &quot;session_type&quot;: &quot;social&quot;\n  //...общие поля\n}</code></pre>\n<h2 id=\"-\">Реферальная ссылка</h2>\n<p>Все остальные источники, где фигурируют другие сайты</p>\n<pre><code class=\"language-json\">{\n  &quot;name&quot;: &quot;session&quot;,\n  &quot;session_engine&quot;: &quot;&quot;,\n  &quot;session_eventNum&quot;: 1,\n  &quot;session_hasMarks&quot;: 0,\n  &quot;session_marks&quot;: {},\n  &quot;session_num&quot;: 3,\n  &quot;session_pageNum&quot;: 0,\n  &quot;session_refHost&quot;: &quot;2gis.ru&quot;,\n  &quot;session_start&quot;: &quot;1518743841188&quot;,\n  &quot;session_type&quot;: &quot;referral&quot;\n  //...общие поля\n}</code></pre>\n<h2 id=\"-\">Остальные источники</h2>\n<p><strong>Внутренние сессии</strong> ( <code>internal</code> ) - это когда сессия инициируется на самом сайте (посетитель продолжил просмотр спустя значительное время).\n<strong>Прямые входы</strong> ( <code>direct</code> ) обычно подразумевают вход через самостоятельный ввод адреса. Но по логике, никто ничего не запоминает, а это ссылки их месседжеров и других программ, за границей браузера.</p>\n<h2 id=\"-\">Подсчет суммы по каналам</h2>\n<p>На основе подробной информации о каждой сессии можно с легкостью посчитать итоговую статистику по каналам и даже сделать из нее realtime дашборд при помощи <a href=\"grafana\">Grafana</a>.</p>\n<p><img src=\"/static/media/alcojs_sessions/sum_by_channel.png\" alt=\"\"></p>\n<h2 id=\"-google-analytics\">Отличия от Google Analytics</h2>\n<p>В отличие от GA, в Rockstat есть внутренние сессии.\nПример: посетитель пришел на сайт, но потом его кто-то отвлек от компьютера, и он отошел,\nза это время сессия завершилась по тайм-ауту, затем он вернулся и продолжил с того места,\nгде остановился. В этой ситуации GA засчитает еще один визит с канала как предыдущий.\nYM также имеет внутренние сессии.</p>\n"}