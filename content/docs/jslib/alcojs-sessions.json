{"data":"<h1 id=\"-\">Обработка сессий</h1>\n<p>Все происходящие события группируются в активные периоды, называемые сессией или визитом.\nСессия начинается при появлении первого события, заканчивается по тайм-ауту.\nЗапуск новой сессии инициируется даже при скролле или движении мыши,\nпоэтому сессии посетителей, которые оставили вкладку открытой,\nа спустя время вернулись и продолжили работу с сайтом,\nбудут начинаться с событий активности. Помимо тайм-аута,\nактивные сессии могут перезапускаться по причине визита того же самого посетителя,\nно с другого источника.</p><p>Наложение источников:</p><ul>\n<li><strong>реклама, органика, соцсети:</strong> старая сессия закрывается, новая открывается</li>\n<li><strong>прямые, реферальные входы:</strong> сессия не перезапускается</li>\n</ul>\n<h2 id=\"-session\">Событие session</h2>\n<p>Сессия, как и все остальное в Rockstat, является самостоятельным событием, генерируемым в момент старта. В дальнейшем все другие события включают в себя сессионную информацию и являются ее распространителем.</p><h2 id=\"-\">Типы сессий</h2>\n<ul>\n<li><strong>Прямой вход</strong></li>\n<li><strong>Органика</strong></li>\n<li><strong>Рекламная кампания</strong></li>\n<li><strong>Социальные сети</strong></li>\n<li><strong>Реферальная ссылка</strong></li>\n<li><strong>Внутренняя сессия</strong></li>\n</ul>\n<h2 id=\"-\">Рекламная кампании</h2>\n<p>Сессия будет рекламной, если в параметрах есть хоть одна из этих меток: <code>utm_*</code>, <code>yclid</code>, <code>gclid</code>, <code>openstat</code>.\nВ некоторых случаях визит может быть классифицирован как рекламный, на основе referrer, например, c <code>doubleclick.net</code></p><pre><code class=\"language-json\">{\n  <span class=\"hljs-string\">\"name\"</span>: <span class=\"hljs-string\">\"session\"</span>,\n  <span class=\"hljs-string\">\"session_engine\"</span>: <span class=\"hljs-string\">\"google\"</span>, <span class=\"hljs-regexp\">//</span> Идентификатор поискового<span class=\"hljs-regexp\">/рекламного/</span>социального движка\n  <span class=\"hljs-string\">\"session_pageNum\"</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-regexp\">//</span> Номер просматриваемой страницы\n  <span class=\"hljs-string\">\"session_eventNum\"</span>: <span class=\"hljs-number\">0</span>, <span class=\"hljs-regexp\">//</span> Номер события (пока еще не было)\n  <span class=\"hljs-string\">\"session_hasMarks\"</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-regexp\">//</span> Флаг наличия рекламных меток (на уровне бд, удобнее его иметь)\n  <span class=\"hljs-string\">\"session_marks\"</span>: {\n    <span class=\"hljs-string\">\"has_gclid\"</span>: <span class=\"hljs-string\">\"1\"</span>, <span class=\"hljs-regexp\">//</span> Наличие gclid\n    <span class=\"hljs-string\">\"utm_campaign\"</span>: <span class=\"hljs-string\">\"feb_camp\"</span>,\n    <span class=\"hljs-string\">\"utm_content\"</span>: <span class=\"hljs-string\">\"ad_1\"</span>,\n    <span class=\"hljs-string\">\"utm_medium\"</span>: <span class=\"hljs-string\">\"cpc\"</span>,\n    <span class=\"hljs-string\">\"utm_source\"</span>: <span class=\"hljs-string\">\"google\"</span>\n  },\n  <span class=\"hljs-string\">\"session_num\"</span>: <span class=\"hljs-number\">22</span>, <span class=\"hljs-regexp\">//</span> Номер визита\n  <span class=\"hljs-string\">\"session_refHost\"</span>: <span class=\"hljs-string\">\"https://google.com\"</span>, <span class=\"hljs-regexp\">//</span> Хост из referer\n  <span class=\"hljs-string\">\"session_start\"</span>: <span class=\"hljs-string\">\"1518849857238\"</span>, <span class=\"hljs-regexp\">//</span> timestamp начала сессии (это время)\n  <span class=\"hljs-string\">\"session_type\"</span>: <span class=\"hljs-string\">\"campaign\"</span>, <span class=\"hljs-regexp\">//</span> Классифицированый вид трафика\n  <span class=\"hljs-regexp\">//</span>...\n}</code></pre>\n<h2 id=\"-\">Органика</h2>\n<p>Если источник - домены Google, не реклама и не g+, значит это поисковая система, т.е. органика</p><pre><code class=\"language-json\">{\n  <span class=\"hljs-string\">\"name\"</span>: <span class=\"hljs-string\">\"session\"</span>,\n  <span class=\"hljs-string\">\"session_engine\"</span>: <span class=\"hljs-string\">\"google\"</span>,\n  <span class=\"hljs-string\">\"session_eventNum\"</span>: <span class=\"hljs-number\">0</span>,\n  <span class=\"hljs-string\">\"session_hasMarks\"</span>: <span class=\"hljs-number\">0</span>,\n  <span class=\"hljs-string\">\"session_marks\"</span>: {},\n  <span class=\"hljs-string\">\"session_num\"</span>: <span class=\"hljs-number\">2</span>,\n  <span class=\"hljs-string\">\"session_pageNum\"</span>: <span class=\"hljs-number\">1</span>,\n  <span class=\"hljs-string\">\"session_refHost\"</span>: <span class=\"hljs-string\">\"google.ru\"</span>,\n  <span class=\"hljs-string\">\"session_start\"</span>: <span class=\"hljs-string\">\"1518857893459\"</span>,\n  <span class=\"hljs-string\">\"session_type\"</span>: <span class=\"hljs-string\">\"organic\"</span>,\n  //...общие поля\n}</code></pre>\n<h2 id=\"-\">Соцсети</h2>\n<p>Если источник - социальная сеть и нет рекламных меток, значит трафик социальный</p><pre><code class=\"language-json\">{\n  <span class=\"hljs-attr\">\"name\"</span>: <span class=\"hljs-string\">\"session\"</span>,\n  <span class=\"hljs-attr\">\"session_engine\"</span>: <span class=\"hljs-string\">\"vk\"</span>,\n  <span class=\"hljs-attr\">\"session_eventNum\"</span>: <span class=\"hljs-number\">0</span>,\n  <span class=\"hljs-attr\">\"session_hasMarks\"</span>: <span class=\"hljs-number\">0</span>,\n  <span class=\"hljs-attr\">\"session_marks\"</span>: {},\n  <span class=\"hljs-attr\">\"session_num\"</span>: <span class=\"hljs-number\">4</span>,\n  <span class=\"hljs-attr\">\"session_pageNum\"</span>: <span class=\"hljs-number\">1</span>,\n  <span class=\"hljs-attr\">\"session_refHost\"</span>: <span class=\"hljs-string\">\"away.vk.com\"</span>,\n  <span class=\"hljs-attr\">\"session_start\"</span>: <span class=\"hljs-string\">\"1518856888877\"</span>,\n  <span class=\"hljs-attr\">\"session_type\"</span>: <span class=\"hljs-string\">\"social\"</span>\n  //...общие поля\n}</code></pre>\n<h2 id=\"-\">Реферальная ссылка</h2>\n<p>Все остальные источники, где фигурируют другие сайты</p><pre><code class=\"language-json\">{\n  <span class=\"hljs-attr\">\"name\"</span>: <span class=\"hljs-string\">\"session\"</span>,\n  <span class=\"hljs-attr\">\"session_engine\"</span>: <span class=\"hljs-string\">\"\"</span>,\n  <span class=\"hljs-attr\">\"session_eventNum\"</span>: <span class=\"hljs-number\">1</span>,\n  <span class=\"hljs-attr\">\"session_hasMarks\"</span>: <span class=\"hljs-number\">0</span>,\n  <span class=\"hljs-attr\">\"session_marks\"</span>: {},\n  <span class=\"hljs-attr\">\"session_num\"</span>: <span class=\"hljs-number\">3</span>,\n  <span class=\"hljs-attr\">\"session_pageNum\"</span>: <span class=\"hljs-number\">0</span>,\n  <span class=\"hljs-attr\">\"session_refHost\"</span>: <span class=\"hljs-string\">\"2gis.ru\"</span>,\n  <span class=\"hljs-attr\">\"session_start\"</span>: <span class=\"hljs-string\">\"1518743841188\"</span>,\n  <span class=\"hljs-attr\">\"session_type\"</span>: <span class=\"hljs-string\">\"referral\"</span>\n  //...общие поля\n}</code></pre>\n<h2 id=\"-\">Остальные источники</h2>\n<p><strong>Внутренние сессии</strong> ( <code>internal</code> ) - это когда сессия инициируется на самом сайте (посетитель продолжил просмотр спустя значительное время).\n<strong>Прямые входы</strong> ( <code>direct</code> ) обычно подразумевают вход через самостоятельный ввод адреса. Но по логике, никто ничего не запоминает, а это ссылки их месседжеров и других программ, за границей браузера.</p><h2 id=\"-\">Подсчет суммы по каналам</h2>\n<p>На основе подробной информации о каждой сессии можно с легкостью посчитать итоговую статистику по каналам и даже сделать из нее realtime дашборд при помощи <a href=\"grafana\">Grafana</a>.</p><p><img src=\"/static/media/alcojs_sessions/sum_by_channel.png\" alt=\"\"></p><h2 id=\"-google-analytics\">Отличия от Google Analytics</h2>\n<p>В отличие от GA, в Rockstat есть внутренние сессии.\nПример: посетитель пришел на сайт, но потом его кто-то отвлек от компьютера, и он отошел,\nза это время сессия завершилась по тайм-ауту, затем он вернулся и продолжил с того места,\nгде остановился. В этой ситуации GA засчитает еще один визит с канала как предыдущий.\nYM также имеет внутренние сессии.</p>"}