{
  "bodyContent": "# Обработка сессий\n\nВсе происходящие события группируются в активные периоды, называемые сессией или визитом.\nСессия начинается при появлении первого события, заканчивается по тайм-ауту.\nЗапуск новой сессии инициируется даже при скролле или движении мыши,\nпоэтому сессии посетителей, которые оставили вкладку открытой,\nа спустя время вернулись и продолжили работу с сайтом,\nбудут начинаться с событий активности. Помимо тайм-аута,\nактивные сессии могут перезапускаться по причине визита того же самого посетителя,\nно с другого источника.\n\nНаложение источников:\n\n - **реклама, органика, соцсети:** старая сессия закрывается, новая открывается\n - **прямые, реферальные входы:** сессия не перезапускается\n\n## Событие session\n\nСессия, как и все остальное в Rockstat, является самостоятельным событием, генерируемым в момент старта. В дальнейшем все другие события включают в себя сессионную информацию и являются ее распространителем.\n\n\n## Типы сессий\n\n* **Прямой вход**\n* **Органика**\n* **Рекламная кампания**\n* **Социальные сети**\n* **Реферальная ссылка**\n* **Внутренняя сессия**\n\n## Рекламная кампании\n\nСессия будет рекламной, если в параметрах есть хоть одна из этих меток: `utm_*`, `yclid`, `gclid`, `openstat`.\nВ некоторых случаях визит может быть классифицирован как рекламный, на основе referrer, например, c `doubleclick.net`\n\n\n\n```json\n{\n  \"name\": \"session\",\n  \"session_engine\": \"google\", // Идентификатор поискового/рекламного/социального движка\n  \"session_pageNum\": 1, // Номер просматриваемой страницы\n  \"session_eventNum\": 0, // Номер события (пока еще не было)\n  \"session_hasMarks\": 1, // Флаг наличия рекламных меток (на уровне бд, удобнее его иметь)\n  \"session_marks\": {\n    \"has_gclid\": \"1\", // Наличие gclid\n    \"utm_campaign\": \"feb_camp\",\n    \"utm_content\": \"ad_1\",\n    \"utm_medium\": \"cpc\",\n    \"utm_source\": \"google\"\n  },\n  \"session_num\": 22, // Номер визита\n  \"session_refHost\": \"https://google.com\", // Хост из referer\n  \"session_start\": \"1518849857238\", // timestamp начала сессии (это время)\n  \"session_type\": \"campaign\", // Классифицированый вид трафика\n  //...\n}\n```\n\n\n## Органика\n\nЕсли источник - домены Google, не реклама и не g+, значит это поисковая система, т.е. органика\n\n\n```json\n{\n  \"name\": \"session\",\n  \"session_engine\": \"google\",\n  \"session_eventNum\": 0,\n  \"session_hasMarks\": 0,\n  \"session_marks\": {},\n  \"session_num\": 2,\n  \"session_pageNum\": 1,\n  \"session_refHost\": \"google.ru\",\n  \"session_start\": \"1518857893459\",\n  \"session_type\": \"organic\",\n  //...общие поля\n}\n```\n\n## Соцсети\n\nЕсли источник - социальная сеть и нет рекламных меток, значит трафик социальный\n\n```json\n{\n  \"name\": \"session\",\n  \"session_engine\": \"vk\",\n  \"session_eventNum\": 0,\n  \"session_hasMarks\": 0,\n  \"session_marks\": {},\n  \"session_num\": 4,\n  \"session_pageNum\": 1,\n  \"session_refHost\": \"away.vk.com\",\n  \"session_start\": \"1518856888877\",\n  \"session_type\": \"social\"\n  //...общие поля\n}\n```\n\n## Реферальная ссылка\n\nВсе остальные источники, где фигурируют другие сайты\n\n```json\n{\n  \"name\": \"session\",\n  \"session_engine\": \"\",\n  \"session_eventNum\": 1,\n  \"session_hasMarks\": 0,\n  \"session_marks\": {},\n  \"session_num\": 3,\n  \"session_pageNum\": 0,\n  \"session_refHost\": \"2gis.ru\",\n  \"session_start\": \"1518743841188\",\n  \"session_type\": \"referral\"\n  //...общие поля\n}\n```\n## Остальные источники\n\n**Внутренние сессии** ( `internal` ) - это когда сессия инициируется на самом сайте (посетитель продолжил просмотр спустя значительное время).\n**Прямые входы** ( `direct` ) обычно подразумевают вход через самостоятельный ввод адреса. Но по логике, никто ничего не запоминает, а это ссылки их месседжеров и других программ, за границей браузера.\n\n## Подсчет суммы по каналам\n\nНа основе подробной информации о каждой сессии можно с легкостью посчитать итоговую статистику по каналам и даже сделать из нее realtime дашборд при помощи [Grafana](grafana).\n\n![](/static/media/alcojs_sessions/sum_by_channel.png)\n\n## Отличия от Google Analytics\n\nВ отличие от GA, в Rockstat есть внутренние сессии.\nПример: посетитель пришел на сайт, но потом его кто-то отвлек от компьютера, и он отошел,\nза это время сессия завершилась по тайм-ауту, затем он вернулся и продолжил с того места,\nгде остановился. В этой ситуации GA засчитает еще один визит с канала как предыдущий.\nYM также имеет внутренние сессии.",
  "bodyHtml": "<h1>Обработка сессий</h1>\n<p>Все происходящие события группируются в активные периоды, называемые сессией или визитом.\nСессия начинается при появлении первого события, заканчивается по тайм-ауту.\nЗапуск новой сессии инициируется даже при скролле или движении мыши,\nпоэтому сессии посетителей, которые оставили вкладку открытой,\nа спустя время вернулись и продолжили работу с сайтом,\nбудут начинаться с событий активности. Помимо тайм-аута,\nактивные сессии могут перезапускаться по причине визита того же самого посетителя,\nно с другого источника.</p>\n<p>Наложение источников:</p>\n<ul>\n<li><strong>реклама, органика, соцсети:</strong> старая сессия закрывается, новая открывается</li>\n<li><strong>прямые, реферальные входы:</strong> сессия не перезапускается</li>\n</ul>\n<h2>Событие session</h2>\n<p>Сессия, как и все остальное в Rockstat, является самостоятельным событием, генерируемым в момент старта. В дальнейшем все другие события включают в себя сессионную информацию и являются ее распространителем.</p>\n<h2>Типы сессий</h2>\n<ul>\n<li><strong>Прямой вход</strong></li>\n<li><strong>Органика</strong></li>\n<li><strong>Рекламная кампания</strong></li>\n<li><strong>Социальные сети</strong></li>\n<li><strong>Реферальная ссылка</strong></li>\n<li><strong>Внутренняя сессия</strong></li>\n</ul>\n<h2>Рекламная кампании</h2>\n<p>Сессия будет рекламной, если в параметрах есть хоть одна из этих меток: <code>utm_*</code>, <code>yclid</code>, <code>gclid</code>, <code>openstat</code>.\nВ некоторых случаях визит может быть классифицирован как рекламный, на основе referrer, например, c <code>doubleclick.net</code></p>\n<pre><code class=\"hljs\">{\n  \"name\": \"session\",\n  \"session_engine\": \"google\", // Идентификатор поискового/рекламного/социального движка\n  \"session_pageNum\": 1, // Номер просматриваемой страницы\n  \"session_eventNum\": 0, // Номер события (пока еще не было)\n  \"session_hasMarks\": 1, // Флаг наличия рекламных меток (на уровне бд, удобнее его иметь)\n  \"session_marks\": {\n    \"has_gclid\": \"1\", // Наличие gclid\n    \"utm_campaign\": \"feb_camp\",\n    \"utm_content\": \"ad_1\",\n    \"utm_medium\": \"cpc\",\n    \"utm_source\": \"google\"\n  },\n  \"session_num\": 22, // Номер визита\n  \"session_refHost\": \"https://google.com\", // Хост из referer\n  \"session_start\": \"1518849857238\", // timestamp начала сессии (это время)\n  \"session_type\": \"campaign\", // Классифицированый вид трафика\n  //...\n}</code></pre><h2>Органика</h2>\n<p>Если источник - домены Google, не реклама и не g+, значит это поисковая система, т.е. органика</p>\n<pre><code class=\"hljs\">{\n  \"name\": \"session\",\n  \"session_engine\": \"google\",\n  \"session_eventNum\": 0,\n  \"session_hasMarks\": 0,\n  \"session_marks\": {},\n  \"session_num\": 2,\n  \"session_pageNum\": 1,\n  \"session_refHost\": \"google.ru\",\n  \"session_start\": \"1518857893459\",\n  \"session_type\": \"organic\",\n  //...общие поля\n}</code></pre><h2>Соцсети</h2>\n<p>Если источник - социальная сеть и нет рекламных меток, значит трафик социальный</p>\n<pre><code class=\"hljs\">{\n  <span class=\"hljs-attr\">\"name\"</span>: <span class=\"hljs-string\">\"session\"</span>,\n  <span class=\"hljs-attr\">\"session_engine\"</span>: <span class=\"hljs-string\">\"vk\"</span>,\n  <span class=\"hljs-attr\">\"session_eventNum\"</span>: <span class=\"hljs-number\">0</span>,\n  <span class=\"hljs-attr\">\"session_hasMarks\"</span>: <span class=\"hljs-number\">0</span>,\n  <span class=\"hljs-attr\">\"session_marks\"</span>: {},\n  <span class=\"hljs-attr\">\"session_num\"</span>: <span class=\"hljs-number\">4</span>,\n  <span class=\"hljs-attr\">\"session_pageNum\"</span>: <span class=\"hljs-number\">1</span>,\n  <span class=\"hljs-attr\">\"session_refHost\"</span>: <span class=\"hljs-string\">\"away.vk.com\"</span>,\n  <span class=\"hljs-attr\">\"session_start\"</span>: <span class=\"hljs-string\">\"1518856888877\"</span>,\n  <span class=\"hljs-attr\">\"session_type\"</span>: <span class=\"hljs-string\">\"social\"</span>\n  //...общие поля\n}</code></pre><h2>Реферальная ссылка</h2>\n<p>Все остальные источники, где фигурируют другие сайты</p>\n<pre><code class=\"hljs\">{\n  <span class=\"hljs-attr\">\"name\"</span>: <span class=\"hljs-string\">\"session\"</span>,\n  <span class=\"hljs-attr\">\"session_engine\"</span>: <span class=\"hljs-string\">\"\"</span>,\n  <span class=\"hljs-attr\">\"session_eventNum\"</span>: <span class=\"hljs-number\">1</span>,\n  <span class=\"hljs-attr\">\"session_hasMarks\"</span>: <span class=\"hljs-number\">0</span>,\n  <span class=\"hljs-attr\">\"session_marks\"</span>: {},\n  <span class=\"hljs-attr\">\"session_num\"</span>: <span class=\"hljs-number\">3</span>,\n  <span class=\"hljs-attr\">\"session_pageNum\"</span>: <span class=\"hljs-number\">0</span>,\n  <span class=\"hljs-attr\">\"session_refHost\"</span>: <span class=\"hljs-string\">\"2gis.ru\"</span>,\n  <span class=\"hljs-attr\">\"session_start\"</span>: <span class=\"hljs-string\">\"1518743841188\"</span>,\n  <span class=\"hljs-attr\">\"session_type\"</span>: <span class=\"hljs-string\">\"referral\"</span>\n  //...общие поля\n}</code></pre><h2>Остальные источники</h2>\n<p><strong>Внутренние сессии</strong> ( <code>internal</code> ) - это когда сессия инициируется на самом сайте (посетитель продолжил просмотр спустя значительное время).\n<strong>Прямые входы</strong> ( <code>direct</code> ) обычно подразумевают вход через самостоятельный ввод адреса. Но по логике, никто ничего не запоминает, а это ссылки их месседжеров и других программ, за границей браузера.</p>\n<h2>Подсчет суммы по каналам</h2>\n<p>На основе подробной информации о каждой сессии можно с легкостью посчитать итоговую статистику по каналам и даже сделать из нее realtime дашборд при помощи <a href=\"grafana\">Grafana</a>.</p>\n<p><img src=\"/static/media/alcojs_sessions/sum_by_channel.png\" alt=\"\"></p>\n<h2>Отличия от Google Analytics</h2>\n<p>В отличие от GA, в Rockstat есть внутренние сессии.\nПример: посетитель пришел на сайт, но потом его кто-то отвлек от компьютера, и он отошел,\nза это время сессия завершилась по тайм-ауту, затем он вернулся и продолжил с того места,\nгде остановился. В этой ситуации GA засчитает еще один визит с канала как предыдущий.\nYM также имеет внутренние сессии.</p>\n",
  "preview": "Обработка сессий\n\nВсе происходящие события группируются в активные периоды, называемые сессией или",
  "title": "Обработка сессий",
  "dir": "content/docs/jslib",
  "base": "alcojs-sessions.json",
  "ext": ".json",
  "sourceBase": "alcojs-sessions.md",
  "sourceExt": ".md"
}