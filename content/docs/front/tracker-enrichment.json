{"data":"<h1 id=\"-\">Обогащение на сервере</h1>\n<p>При получении данных на вход, серверная часть трекера производит обогащение данных на осноые доступных источников. В данный момент их 3, но архитектура подоготовлена для того, чтобы их было много и в скором времени список будет пополнен.</p><h2 id=\"core\">Core</h2>\n<p>Это не совсем обогатитель, но дописывает параметры уровня HTTP при получении данных</p><pre><code class=\"language-json\">  <span class=\"hljs-string\">\"ip\"</span>: <span class=\"hljs-string\">\"172.17.121.1\"</span>, <span class=\"hljs-comment\">// ip</span>\n  <span class=\"hljs-string\">\"userAgent\"</span>: <span class=\"hljs-string\">\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_2) ...Chrome/63.0.3239.132 Safari/537.36\"</span>,\n  <span class=\"hljs-string\">\"time\"</span>: <span class=\"hljs-string\">\"'</span>Fri Mar <span class=\"hljs-number\">16</span> <span class=\"hljs-number\">2018</span> <span class=\"hljs-number\">01</span>:<span class=\"hljs-number\">04</span>:<span class=\"hljs-number\">33</span> GMT (GMT)<span class=\"hljs-string\">'\"</span></code></pre>\n<h2 id=\"matomo-device-detector\">Matomo Device Detector</h2>\n<p>Обогатитель на базе библиотекти разбора User-Agent из Matomo (Piwik)</p><pre><code class=\"language-json\">\n  <span class=\"hljs-comment\">// Результаты разбора user-agent</span>\n  <span class=\"hljs-string\">\"mdd\"</span>: {\n    <span class=\"hljs-string\">\"isBot\"</span>: <span class=\"hljs-number\">0</span>, <span class=\"hljs-comment\">// Признак бота, если он представился, как делают поисковые и аналитические боты</span>\n    <span class=\"hljs-string\">\"os\"</span>: {\n      <span class=\"hljs-string\">\"name\"</span>: <span class=\"hljs-string\">\"Mac\"</span>,\n      <span class=\"hljs-string\">\"platform\"</span>: <span class=\"hljs-string\">\"\"</span>,\n      <span class=\"hljs-string\">\"version\"</span>: <span class=\"hljs-string\">\"10.13\"</span>,\n    },\n    <span class=\"hljs-comment\">// Если визит с мобильного телефона, будет показывать производителя и модель аппарата</span>\n    <span class=\"hljs-string\">\"device\"</span>: { \n      <span class=\"hljs-string\">\"brand\"</span>: <span class=\"hljs-string\">\"\"</span>,\n      <span class=\"hljs-string\">\"model\"</span>: <span class=\"hljs-string\">\"\"</span>,\n      <span class=\"hljs-string\">\"type\"</span>: <span class=\"hljs-string\">\"desktop\"</span>,\n    },\n    <span class=\"hljs-comment\">// Может быть мобильное приложение, телевизор или игровая консоль</span>\n    <span class=\"hljs-string\">\"client\"</span>: {\n      <span class=\"hljs-string\">\"type\"</span>: <span class=\"hljs-string\">\"browser\"</span>,\n      <span class=\"hljs-string\">\"name\"</span>: <span class=\"hljs-string\">\"Chrome\"</span>,\n      <span class=\"hljs-string\">\"version\"</span>: <span class=\"hljs-string\">\"63.0\"</span>,\n    }\n  }\n</code></pre>\n<h2 id=\"sypex-geo-ip\">Sypex Geo IP</h2>\n<p>Обогатитель определяющий регион по IP на базе библиотеки Sypex Geo</p><pre><code class=\"language-json\">\n  // Результаты гео-кодинга по ip\n  <span class=\"hljs-string\">\"sxg\"</span>: {\n    <span class=\"hljs-string\">\"city\"</span>: {\n      <span class=\"hljs-string\">\"id\"</span>: <span class=\"hljs-number\">524901</span>,\n      <span class=\"hljs-string\">\"name_en\"</span>: <span class=\"hljs-string\">\"Moscow\"</span>,\n      <span class=\"hljs-string\">\"name_ru\"</span>: <span class=\"hljs-string\">\"Москва\"</span>\n    },\n    <span class=\"hljs-string\">\"region\"</span>: {\n      <span class=\"hljs-string\">\"iso\"</span>: <span class=\"hljs-string\">\"RU-MOW\"</span>,\n      <span class=\"hljs-string\">\"name_en\"</span>: <span class=\"hljs-string\">\"Moskva\"</span>,\n      <span class=\"hljs-string\">\"name_ru\"</span>: <span class=\"hljs-string\">\"Москва\"</span>\n    },\n    <span class=\"hljs-string\">\"country\"</span>: {\n      <span class=\"hljs-string\">\"iso\"</span>: <span class=\"hljs-string\">\"RU\"</span>,\n      <span class=\"hljs-string\">\"name_en\"</span>: <span class=\"hljs-string\">\"Russia\"</span>,\n      <span class=\"hljs-string\">\"name_ru\"</span>: <span class=\"hljs-string\">\"Россия\"</span>\n    }\n  }\n</code></pre>\n<h2 id=\"page-url-parser\">Page url parser</h2>\n<p>Это очень простой обогатитель, разбирающий на кусочки адрес страницы на которой произошло событие</p><pre><code class=\"language-json\">\n  <span class=\"hljs-string\">\"page\"</span>: {\n    <span class=\"hljs-string\">\"domain\"</span>: <span class=\"hljs-string\">\"somedomain.ru\"</span>,\n    <span class=\"hljs-string\">\"proto\"</span>: <span class=\"hljs-string\">\"https\"</span>\n    <span class=\"hljs-string\">\"query\"</span>: {\n      <span class=\"hljs-string\">\"aaa\"</span>: <span class=\"hljs-string\">\"bbb\"</span>,\n      <span class=\"hljs-string\">\"utm_source\"</span>: <span class=\"hljs-string\">\"youporn\"</span>\n    }\n  }\n</code></pre>\n"}