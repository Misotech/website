# Обогащение на сервере

При получении данных на вход, серверная часть трекера производит обогащение данных на осноые доступных источников. В данный момент их 3, но архитектура подоготовлена для того, чтобы их было много и в скором времени список будет пополнен.


## Core

Это не совсем обогатитель, но дописывает параметры уровня HTTP при получении данных

```json
  "ip": "172.17.121.1", // ip
  "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_2) ...Chrome/63.0.3239.132 Safari/537.36",
  "time": "'Fri Mar 16 2018 01:04:33 GMT (GMT)'"
```



## Matomo Device Detector

Обогатитель на базе библиотекти разбора User-Agent из Matomo (Piwik)

```json
  
  // Результаты разбора user-agent
  "mdd": {
    "isBot": 0, // Признак бота, если он представился, как делают поисковые и аналитические боты
    "os": {
      "name": "Mac",
      "platform": "",
      "version": "10.13",
    },
    // Если визит с мобильного телефона, будет показывать производителя и модель аппарата
    "device": { 
      "brand": "",
      "model": "",
      "type": "desktop",
    },
    // Может быть мобильное приложение, телевизор или игровая консоль
    "client": {
      "type": "browser",
      "name": "Chrome",
      "version": "63.0",
    }
  }

```


## Sypex Geo IP

Обогатитель определяющий регион по IP на базе библиотеки Sypex Geo

```json

  // Результаты гео-кодинга по ip
  "sxg": {
    "city": {
      "id": 524901,
      "name_en": "Moscow",
      "name_ru": "Москва"
    },
    "region": {
      "iso": "RU-MOW",
      "name_en": "Moskva",
      "name_ru": "Москва"
    },
    "country": {
      "iso": "RU",
      "name_en": "Russia",
      "name_ru": "Россия"
    }
  }

```

## Page url parser

Это очень простой обогатитель, разбирающий на кусочки адрес страницы на которой произошло событие

```json

  "page": {
    "domain": "somedomain.ru",
    "proto": "https"
    "query": {
      "aaa": "bbb",
      "utm_source": "youporn"
    }
  }

```

